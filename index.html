<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡é‚®ä»¶å‘é€å·¥å…·</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- React å’Œ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React Quill -->
    <script src="https://unpkg.com/react-quill@2.0.0/dist/react-quill.js"></script>
    <link href="https://unpkg.com/react-quill@2.0.0/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“§ æ‰¹é‡é‚®ä»¶å‘é€å·¥å…·</h1>
            <p>æ”¯æŒé£ä¹¦é‚®ç®±å’ŒGmailï¼Œè½»æ¾å®ç°ä¸ªæ€§åŒ–æ‰¹é‡é‚®ä»¶å‘é€</p>
        </header>

        <!-- é‚®ä»¶æœåŠ¡å•†é€‰æ‹© -->
        <section class="email-provider-section">
            <h2>ğŸ“® é‚®ä»¶æœåŠ¡å•†</h2>
            <div class="provider-options">
                <label class="provider-option active">
                    <input type="radio" name="provider" value="feishu" checked>
                    <span class="provider-icon">ğŸ“¨</span>
                    <span class="provider-name">é£ä¹¦é‚®ç®±</span>
                    <span class="provider-status">å·²å¯ç”¨</span>
                </label>
                <label class="provider-option disabled">
                    <input type="radio" name="provider" value="gmail" disabled>
                    <span class="provider-icon">ğŸ“§</span>
                    <span class="provider-name">Gmail</span>
                    <span class="provider-status coming-soon">å³å°†ä¸Šçº¿</span>
                </label>
            </div>
        </section>

        <!-- å‘ä»¶äººç®¡ç† -->
        <section class="sender-management-section">
            <h2>ğŸ‘¤ å‘ä»¶äººç®¡ç†</h2>
            <div class="sender-list" id="senderList">
                <!-- å‘ä»¶äººåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addSender()">
                â• æ·»åŠ å‘ä»¶äºº
            </button>
            <div class="sender-help">
                <h4>ğŸ“‹ å¦‚ä½•é…ç½®å‘ä»¶äººï¼Ÿ</h4>
                <div class="help-content">
                    <h5>é£ä¹¦é‚®ç®±é…ç½®ï¼š</h5>
                    <ol>
                        <li>ç™»å½•é£ä¹¦é‚®ç®±ç®¡ç†åå°</li>
                        <li>è¿›å…¥"è®¾ç½®" â†’ "IMAP/SMTPæœåŠ¡"</li>
                        <li>å¼€å¯SMTPæœåŠ¡ï¼Œè·å–åº”ç”¨å¯†ç </li>
                        <li>å¡«å†™é‚®ç®±åœ°å€å’Œåº”ç”¨å¯†ç </li>
                    </ol>
                    <h5>Gmailé…ç½®ï¼ˆå³å°†æ”¯æŒï¼‰ï¼š</h5>
                    <ol>
                        <li>å¼€å¯Gmailä¸¤æ­¥éªŒè¯</li>
                        <li>ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç </li>
                        <li>å¡«å†™Gmailåœ°å€å’Œåº”ç”¨å¯†ç </li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <section class="upload-section">
            <h2>ğŸ“ ä¸Šä¼ è”ç³»äººæ•°æ®</h2>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">
                <div class="upload-content">
                    <div class="upload-icon">ğŸ“„</div>
                    <p>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                    <p class="upload-hint">æ”¯æŒ CSVã€Excel æ ¼å¼ï¼Œéœ€åŒ…å« Emailã€Creator Nameã€Social Media Link åˆ—</p>
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        é€‰æ‹©æ–‡ä»¶
                    </button>
                </div>
            </div>
        </section>

        <!-- æ•°æ®é¢„è§ˆåŒºåŸŸ -->
        <section class="preview-section" id="previewSection" style="display: none;">
            <h2>ğŸ“Š æ•°æ®é¢„è§ˆ</h2>
            <div class="preview-controls">
                <span id="previewCount"></span>
                <button type="button" class="btn btn-secondary" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
            </div>
            <div class="table-container">
                <table id="previewTable">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Creator Name</th>
                            <th>Social Media Link</th>
                        </tr>
                    </thead>
                    <tbody id="previewTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- é‚®ä»¶æ¨¡æ¿åŒºåŸŸ -->
        <section class="template-section">
            <h2>âœï¸ é‚®ä»¶æ¨¡æ¿</h2>
            <div class="template-controls">
                <label for="emailSubject">é‚®ä»¶ä¸»é¢˜ï¼š</label>
                <input type="text" id="emailSubject" placeholder="è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜" value="Hi {Creator Name}, I'm Sean from Insty.cc">
            </div>
            
            <!-- React Quill ç¼–è¾‘å™¨å®¹å™¨ -->
            <div id="quillEditor"></div>
        </section>

        <!-- å‘é€è®¾ç½®åŒºåŸŸ -->
        <section class="send-settings-section">
            <h2>âš™ï¸ å‘é€è®¾ç½®</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="sendMethod">å‘é€æ–¹å¼ï¼š</label>
                    <select id="sendMethod">
                        <option value="smtp">SMTPï¼ˆæ¨èï¼‰</option>
                        <option value="api">API</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="sendInterval">å‘é€é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
                    <input type="number" id="sendInterval" value="2000" min="1000" max="10000">
                </div>
                <div class="setting-item">
                    <button type="button" class="btn btn-secondary" onclick="testConnection()">
                        ğŸ” æµ‹è¯•è¿æ¥
                    </button>
                </div>
            </div>
        </section>

        <!-- å‘é€æ§åˆ¶åŒºåŸŸ -->
        <section class="send-control-section">
            <div class="send-controls">
                <button type="button" class="btn btn-primary" id="startBtn" onclick="startSending()">
                    ğŸš€ å¼€å§‹å‘é€
                </button>
                <button type="button" class="btn btn-danger" id="stopBtn" onclick="stopSending()" style="display: none;">
                    â¹ï¸ åœæ­¢å‘é€
                </button>
            </div>
            
            <div class="send-status" id="sendStatus" style="display: none;">
                <div class="status-info">
                    <span id="statusText">å‡†å¤‡å‘é€...</span>
                    <span id="progressText">0 / 0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </section>

        <!-- å‘é€æ—¥å¿—åŒºåŸŸ -->
        <section class="log-section" id="logSection" style="display: none;">
            <h2>ğŸ“‹ å‘é€æ—¥å¿—</h2>
            <div class="log-controls">
                <button type="button" class="btn btn-secondary" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                <button type="button" class="btn btn-secondary" onclick="exportLog()">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            <div class="log-container" id="logContainer"></div>
        </section>
    </div>

    <script type="text/babel">
        // React Quill ç¼–è¾‘å™¨ç»„ä»¶
        const { useState, useEffect, useRef } = React;
        
        const QuillEditor = () => {
            const [value, setValue] = useState(`
                <p>Hi {Creator Name},</p>
                <p>I'm Sean Creator Manager at Insty.cc, and I've been genuinely impressed by your content on {Social Media Link}.</p>
                <p>We would love to collaborate with you on some exciting projects.</p>
                <p>Best regards,<br>Sean<br>Insty.cc</p>
            `);
            
            const quillRef = useRef(null);
            
            // è‡ªå®šä¹‰å·¥å…·æ 
            const modules = {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'font': [] }],
                    [{ 'size': ['small', false, 'large', 'huge'] }],
                    [{ 'align': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['blockquote', 'code-block'],
                    ['link', 'image'],
                    ['clean']
                ],
                clipboard: {
                    matchVisual: false
                }
            };
            
            const formats = [
                'header', 'font', 'size',
                'bold', 'italic', 'underline', 'strike', 'blockquote',
                'list', 'bullet', 'indent',
                'link', 'image', 'video',
                'color', 'background',
                'align', 'direction', 'code-block'
            ];
            
            // æ’å…¥å˜é‡çš„å‡½æ•°
            const insertVariable = (variableName) => {
                if (quillRef.current) {
                    const editor = quillRef.current.getEditor();
                    const range = editor.getSelection();
                    const position = range ? range.index : 0;
                    editor.insertText(position, `{${variableName}}`);
                }
            };
            
            // å°†æ’å…¥å˜é‡å‡½æ•°æš´éœ²åˆ°å…¨å±€
            useEffect(() => {
                window.insertVariable = insertVariable;
                window.getQuillContent = () => value;
            }, [value]);
            
            return (
                <div className="quill-editor-container">
                    <div className="quill-toolbar-extra">
                        <button 
                            type="button" 
                            className="btn btn-secondary" 
                            onClick={() => insertVariable('Creator Name')}
                            title="æ’å…¥åˆ›å»ºè€…å§“å"
                        >
                            ğŸ‘¤ Creator Name
                        </button>
                        <button 
                            type="button" 
                            className="btn btn-secondary" 
                            onClick={() => insertVariable('Social Media Link')}
                            title="æ’å…¥ç¤¾äº¤åª’ä½“é“¾æ¥"
                        >
                            ğŸ”— Social Media Link
                        </button>
                    </div>
                    <ReactQuill
                        ref={quillRef}
                        theme="snow"
                        value={value}
                        onChange={setValue}
                        modules={modules}
                        formats={formats}
                        placeholder="å¼€å§‹ç¼–å†™æ‚¨çš„é‚®ä»¶å†…å®¹..."
                        style={{ height: '300px' }}
                    />
                </div>
            );
        };
        
        // æ¸²æŸ“ React Quill ç¼–è¾‘å™¨
        ReactDOM.render(<QuillEditor />, document.getElementById('quillEditor'));
    </script>

    <script src="script.js"></script>
</body>
</html>
